<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <!-- Material Icons -->
        <link
            href="https://fonts.googleapis.com/icon?family=Material+Icons"
            rel="stylesheet"
        />

        <title>Prancha</title>
    </head>
    <body>
        <h1>Prancha IFCE</h1>

        <form id="termo-form">
            <h3>Formulário de Termos</h3>
            <input type="hidden" id="termo-id" />

            <div>
                <label for="termo-titulo">Título</label>
                <input type="text" id="termo-titulo" required />
            </div>

            <div>
                <label for="termo-imagem">Imagem</label>
                <input type="text" id="termo-imagem" />
            </div>

            <div>
                <label for="termo-ordem">Ordem</label>
                <input type="number" id="termo-ordem" required />
            </div>

            <div>
                <label for="termo-cat">Categoria</label>
                <select id="termo-cat" required>
                    <option value="" disabled selected>Escolha</option>
                </select>
            </div>

            <button type="submit">Salvar</button>
        </form>

        <h3>Lista de termos</h3>
        <table id="termo-table">
            <thead>
                <tr>
                    <th>Título</th>
                    <th>Imagem</th>
                    <th>Ordem</th>
                    <th>Categoria</th>
                    <th></th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <script>
            // Dados
            let cats = [
                {
                    id: 1635159911910,
                    titulo: "Cat 1",
                    cor: "#FF0000",
                    ordem: "1",
                    termos: [
                        {
                            id: 1635165848820,
                            titulo: "Termo 2",
                            imagem: "Imagem 2",
                            ordem: "300",
                            categoria_id: 1635159911910,
                        },
                    ],
                },
                {
                    id: 1635159915876,
                    titulo: "Cat 2",
                    cor: "#009900",
                    ordem: "2",
                    termos: [],
                },
                {
                    id: 1635159920040,
                    titulo: "Cat 3",
                    cor: "#0000FF",
                    ordem: "3",
                    termos: [
                        {
                            id: 1635165750796,
                            titulo: "Termo 1",
                            imagem: "Imagem 1",
                            ordem: "1",
                            categoria_id: 1635159920040,
                        },
                    ],
                },
            ];

            let termoForm = document.querySelector("#termo-form");
            termoForm.addEventListener("submit", (evt) => {
                evt.preventDefault();

                let id = document.querySelector("#termo-id").value;
                let titulo = document.querySelector("#termo-titulo").value;
                let imagem = document.querySelector("#termo-imagem").value;
                let ordem = document.querySelector("#termo-ordem").value;
                let cat = document.querySelector("#termo-cat").value;

                let termo = {
                    id: id,
                    titulo: titulo,
                    imagem: imagem,
                    ordem: ordem,
                    categoria_id: cat,
                };

                if (!id) {
                    // Criação
                    termo.id = new Date().getTime();

                    // Encontrar a categoria
                    let index = encontrarCategoria(termo.categoria_id);

                    if (index === -1) {
                        alert("Id inválido");
                    } else {
                        cats[index].termos.push(termo);
                    }
                } else {
                    // Modificação
                }

                printTermos();
                evt.target.reset();
            });

            function encontrarCategoria(id) {
                return cats.findIndex((cat) => {
                    return cat.id === parseInt(id);
                });
            }

            function printTermos() {
                let termoTableBody =
                    document.querySelector("#termo-table tbody");

                termoTableBody.innerHTML = "";

                // Para cada categoria
                cats.forEach((cat) => {
                    // Para cada termo
                    cat.termos.forEach((termo) => {
                        let tr = document.createElement("tr");
                        tr.innerHTML = `
                                        <td>${termo.titulo}</td>
                                        <td>${termo.imagem}</td>
                                        <td>${termo.ordem}</td>
                                        <td>${cat.titulo}</td>

                                        <td>
                                            <button onclick="carregarTermo(${termo.categoria_id}, ${termo.id})"><span class="material-icons">edit</span></button>
                                            <button onclick="deletarTermo(${termo.categoria_id}, ${termo.id})"><span class="material-icons">delete</span></button>
                                        </td>
                                    `;

                        termoTableBody.append(tr);
                    });
                });
            }

            function carregarTermo(categoriaId, termoId) {
                alert("Carregar termo");
            }

            function deletarTermo(categoriaId, termoId) {
                alert("Deletar termo");
            }

            function printCategorias() {
                let select = document.querySelector("#termo-cat");

                cats.forEach((cat) => {
                    let opt = document.createElement("option");
                    opt.value = cat.id;
                    opt.innerText = cat.titulo;

                    select.append(opt);
                });
            }

            printTermos();
            printCategorias();
        </script>
    </body>
</html>
